{% extends 'tapnote/base.html' %}
{% load static %}

{% block meta %}
<meta property="og:title" content="{{ meta_title }}">
<meta property="og:description" content="{{ meta_description }}">
<meta property="og:type" content="article">
<meta property="og:site_name" content="TeleNote">
{% if meta_image %}
<meta property="og:image" content="{{ meta_image }}">
<meta name="twitter:image" content="{{ meta_image }}">
<meta name="twitter:card" content="summary_large_image">
{% else %}
<meta name="twitter:card" content="summary">
{% endif %}
<meta name="twitter:title" content="{{ meta_title }}">
<meta name="twitter:description" content="{{ meta_description }}">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-3xl">
    {% if can_edit %}
    <div class="flex justify-end mb-8 space-x-4">
        <button onclick="copyEditLink()" class="text-gray-400 hover:text-gray-600 transition-colors text-sm" title="Copy link to restore edit access">
            Backup Edit Link
        </button>
        <a href="{% url 'edit_note' note.hashcode %}" class="px-6 py-2 border border-black rounded-full hover:bg-black hover:text-white transition-colors">
            Edit
        </a>
    </div>
    <script>
        function copyEditLink() {
            const url = window.location.origin + "{% url 'view_note' note.hashcode %}?token={{ note.edit_token }}";
            navigator.clipboard.writeText(url).then(() => {
                alert("Edit link copied to clipboard! Save this link to restore edit access.");
            });
        }
    </script>
    {% endif %}
    
    {% if note.title or note.author %}
    <header class="mb-8 border-b border-gray-100 pb-8">
        {% if note.title %}
        <h1 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900 leading-tight">{{ note.title }}</h1>
        {% endif %}
        <div class="flex items-center text-sm text-gray-500 space-x-3 font-mono">
            {% if note.author %}
            <span class="font-bold text-gray-700">{{ note.author }}</span>
            <span>&middot;</span>
            {% endif %}
            <time datetime="{{ note.created_at|date:'c' }}">{{ note.created_at|date:"M d, Y" }}</time>
        </div>
    </header>
    {% endif %}

    <div class="markdown-content"
         data-na-root
         data-work-id="{{ note.hashcode }}"
         data-chapter-id="main">
        {{ content|safe }}
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% if enable_comments %}
<!-- ParaNote Integration -->
<script
  defer
  src="{% static 'js/paranote.js' %}"
  data-site-id="tapnote"
  data-api-base=""
  {% if can_edit %}data-edit-token="{{ note.edit_token }}"{% endif %}
></script>
{% endif %}
{% endblock %} 